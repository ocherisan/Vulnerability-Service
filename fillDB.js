// Вызов в командной строке
// node fillDB

var async = require('async');
var User = require('./app_server/models/users');

var mongoose = require('mongoose');
var mongoDB = 'mongodb://localhost/Vservice';
mongoose.connect(mongoDB, {userNewUrlParser: true});
mongoose.Promise = global.Promise;
var db = mongoose.connection;
db.on('error', console.error.bind(console, 'MongoDB connection error:'));

var users = [];
function createUser(login, password, email, role, cb) {
    //TODO: сделать здесь получение хэша
    var user = new User({
        login: login,
        hashPassword: password,
        email: email,
        role: role,
        lastEntrance: new Date()
    });

    user.save(function (err) {
        if (err) {
            cb(err, null);
            return;
        }
        console.log('New user ' + user);
        users.push(user);
        cb(null, user);
    });
}

function createUsers(cb) {
    async.series([
       function (callback) {
            createUser('nataly', 'nataly', 'nataly@nataly.nataly', 'admin', callback);
       },
        function (callback) {
            createUser('peter', 'peter', 'peter@peter.peter', 'user', callback);
        }

    ], cb);
}

async.series([
    createUsers
],
    function (err, results) {
        if (err) {
            console.log('Final ERR '+ err);
        }
        mongoose.connection.close();
    });
